//JSON W/ PRODUCTS AND THEIR INFO
const productsArray = [
//==================================HOODIES
//hoodie 1
    {
        id: "1",
        name: "Supreme Hoodie Red",
        image: "../assets/images/Products-img/Hoodies/supreme_classic_red.png",
        category: {
            name: "hoodies",
            id: "hoodies"
        },
        price: 1000
    },
//hoodie 2
    {
        id: "2",
        name: "Supreme Hoodie White",
        image: "../assets/images/Products-img/Hoodies/Supreme-Hoodie-White.png",
        category: {
            name: "hoodies",
            id: "hoodies"
        },
        price: 1000
    },
//hoodie 3
    {
        id: "3",
        name: "Supreme Hoodie Grey",
        image: "../assets/images/Products-img/Hoodies/supreme-hoodie-grey.png",
        category: {
            name: "hoodies",
            id: "hoodies"
        },
        price: 1000
    },
//HOODIE 4
    {
        id: "4",
        name: "Stüssy Hoodie White",
        image: "../assets/images/Products-img/Hoodies/stussy-white.png",
        category: {
            name: "hoodies",
            id: "hoodies"
        },
        price: 1000
    },
//HOODIE 5
    {
        id: "5",
        name: "Stüssy Hoodie Black",
        image: "../assets/images/Products-img/Hoodies/stussy-black.png",
        category: {
            name: "hoodies",
            id: "hoodies"
        },
        price: 1000
    },
//HOODIE 6
    {
        id: "6",
        name: "Stüssy Hoodie Pink",
        image: "../assets/images/Products-img/Hoodies/stussy-pink.png",
        category: {
            name: "hoodies",
            id: "hoodies"
        },
        price: 1000
    },
//HOODIE 7
    {
        id: "7",
        name: "Off-White Hoodie White",
        image: "../assets/images/Products-img/Hoodies/off-white-white.png",
        category: {
            name: "hoodies",
            id: "hoodies"
        },
        price: 1000
    },
//HOODIE 8
    {
        id: "8",
        name: "Off-White Hoodie Moon",
        image: "../assets/images/Products-img/Hoodies/off-white-moon.png",
        category: {
            name: "hoodies",
            id: "hoodies"
        },
        price: 1000
    },
//HOODIE 9
    {
        id: "9",
        name: "Off-White Hoodie weed",
        image: "../assets/images/Products-img/Hoodies/off-white-weed.png",
        category: {
            name: "hoodies",
            id: "hoodies"
        },
        price: 1000
    },
//HOODIE 10
    {
        id: "10",
        name: "Essentials Hoodie Brown",
        image: "../assets/images/Products-img/Hoodies/fear-of-god-light-brown.png",
        category: {
            name: "hoodies",
            id: "hoodies"
        },
        price: 1000
    },
//HOODIE 11
    {
        id: "11",
        name: "Essentials Hoodie Pink",
        image: "../assets/images/Products-img/Hoodies/rose-fear-of-good.png",
        category: {
            name: "hoodies",
            id: "hoodies"
        },
        price: 1000
    },
//HOODIE 12
    {
        id: "12",
        name: "Essentials Hoodie White",
        image: "../assets/images/Products-img/Hoodies/essential-white.png",
        category: {
            name: "hoodies",
            id: "hoodies"
        },
        price: 1000
    },
//HOODIE 13
    {
        id: "13",
        name: "Drew Hoodie Yellow",
        image: "../assets/images/Products-img/Hoodies/Drew-hoodie-yellow.png",
        category: {
            name: "hoodies",
            id: "hoodies"
        },
        price: 1000
    },
//HOODIE 14
    {
        id: "14",
        name: "Drew Hoodie White",
        image: "../assets/images/Products-img/Hoodies/Drew-hoodie-white.png",
        category: {
            name: "hoodies",
            id: "hoodies"
        },
        price: 1000
    },
//HOODIE 15
    {
        id: "15",
        name: "Drew Hoodie Black",
        image: "../assets/images/Products-img/Hoodies/Drew-hoodie-black.png",
        category: {
            name: "hoodies",
            id: "hoodies"
        },
        price: 1000
    },
//HOODIE 16
    {
        id: "16",
        name: "BAPE Hoodie Pink",
        image: "../assets/images/Products-img/Hoodies/BAPE-pink.png",
        category: {
            name: "hoodies",
            id: "hoodies"
        },
        price: 1000
    },
//HOODIE 17
    {
        id: "17",
        name: "BAPE Hoodie Shark Multicolor",
        image: "../assets/images/Products-img/Hoodies/BAPE-multicolor.png",
        category: {
            name: "hoodies",
            id: "hoodies"
        },
        price: 1000
    },
//HOODIE 18
    {
        id: "18",
        name: "BAPE Hoodie Shark gray",
        image: "../assets/images/Products-img/Hoodies/BAPE-gray.png",
        category: {
            name: "hoodies",
            id: "hoodies"
        },
        price: 1000
    },
//HOODIE 19
    {
        id: "19",
        name: "BAPE Hoodie Shark Black",
        image: "../assets/images/Products-img/Hoodies/BAPE-Black.png",
        category: {
            name: "hoodies",
            id: "hoodies"
        },
        price: 1000
    },

//==================== PANTS
//PANT 1
{
    id: "20",
    name: "Supreme Cargo Red",
    image: "../assets/images/Products-img/Pants/supreme-red-military-cargo.png",
    category: {
        name: "pants",
        id: "pants"
    },
    price: 1000
},
//PANT 2
{
    id: "21",
    name: "Supreme Cargo Green",
    image: "../assets/images/Products-img/Pants/supreme-green-cargo.png",
    category: {
        name: "pants",
        id: "pants"
    },
    price: 1000
},
//PANT 3
{
    id: "22",
    name: "Supreme Cargo Black",
    image: "../assets/images/Products-img/Pants/supreme-cargo-black.png",
    category: {
        name: "pants",
        id: "pants"
    },
    price: 1000
},
//PANT 3
{
    id: "23",
    name: "Stüssy Fligh Ripstop ",
    image: "../assets/images/Products-img/Pants/STUSSY-PANTALON-FLIGH-RIPSTOP.png",
    category: {
        name: "pants",
        id: "pants"
    },
    price: 1000
},
//PANT 4
{
    id: "24",
    name: "Stüssy Denim Work",
    image: "../assets/images/Products-img/Pants/stussy-denim-work-pants.png",
    category: {
        name: "pants",
        id: "pants"
    },
    price: 1000
},
//PANT 5
{
    id: "25",
    name: "Essential Pants Green",
    image: "../assets/images/Products-img/Pants/essential-pants-green.png",
    category: {
        name: "pants",
        id: "pants"
    },
    price: 1000
},
//PANT 6
{
    id: "26",
    name: "Essential Pants Black",
    image: "../assets/images/Products-img/Pants/essential-pants-black.png",
    category: {
        name: "pants",
        id: "pants"
    },
    price: 1000
},
//PANT 7
{
    id: "27",
    name: "BAPE Camo Shark Jogger Multicolor",
    image: "../assets/images/Products-img/Pants/Camo-shark-jogger-Bape.png",
    category: {
        name: "pants",
        id: "pants"
    },
    price: 1000
},
//PANT 8
{
    id: "28",
    name: "BAPE Camo Shark Jogger City",
    image: "../assets/images/Products-img/Pants/camo-jogger-city-shark-bape.png",
    category: {
        name: "pants",
        id: "pants"
    },
    price: 1000
},

//T-SHIRTS

//T-SHIRT 1
{
    id: "29",
    name: "blackBack Off-White",
    image: "../assets/images/Products-img/T-shirts/blackback-t-shirt-off-white-removebg-preview.png",
    category: {
        name: "shirts",
        id: "shirts"
    },
    price: 1000
},
//T-SHIRT 2
{
    id: "30",
    name: "Brown Tee Drew",
    image: "../assets/images/Products-img/T-shirts/light-brown-tee-drew-removebg-preview.png",
    category: {
        name: "shirts",
        id: "shirts"
    },
    price: 1000
},
//T-SHIRT 3
{
    id: "31",
    name: "Pink Tee Drew",
    image: "../assets/images/Products-img/T-shirts/pink-tee-drew-removebg-preview.png",
    category: {
        name: "shirts",
        id: "shirts"
    },
    price: 1000
},
//T-SHIRT 4
{
    id: "32",
    name: "White Tee Drew",
    image: "../assets/images/Products-img/T-shirts/white-tee-drew-removebg-preview.png",
    category: {
        name: "shirts",
        id: "shirts"
    },
    price: 1000
},
//T-SHIRT 5
{
    id: "33",
    name: "Stüssy Black",
    image: "../assets/images/Products-img/T-shirts/stussy-t-shirt-black-removebg-preview.png",
    category: {
        name: "shirts",
        id: "shirts"
    },
    price: 1000
},
//T-SHIRT 6
{
    id: "34",
    name: "Stüssy White",
    image: "../assets/images/Products-img/T-shirts/stussy-t-shirt-white-removebg-preview.png",
    category: {
        name: "shirts",
        id: "shirts"
    },
    price: 1000
},
//T-SHIRT 7
{
    id: "35",
    name: "Supreme White Military",
    image: "../assets/images/Products-img/T-shirts/supreme-t-shirt-white-military-removebg-preview.png",
    category: {
        name: "shirts",
        id: "shirts"
    },
    price: 1000
},
//T-SHIRT 8
{
    id: "36",
    name: "Supreme White",
    image: "../assets/images/Products-img/T-shirts/supreme-t-shirt-white-removebg-preview.png",
    category: {
        name: "shirts",
        id: "shirts"
    },
    price: 1000
},

//SNEAKERS

//SNEAKER 1
{
    id: "37",
    name: "Air Force 1 green",
    image: "../assets/images/Products-img/Sneakers/air-force-1-green-removebg-preview.png",
    category: {
        name: "sneakers",
        id: "sneakers"
    },
    price: 1000
},
//SNEAKER 2
{
    id: "38",
    name: "Air Force 1 white",
    image: "../assets/images/Products-img/Sneakers/air-force-1-white-removebg-preview.png",
    category: {
        name: "sneakers",
        id: "sneakers"
    },
    price: 1000
},
//SNEAKER 3
{
    id: "39",
    name: "Jordan 1 Retro High Brown",
    image: "../assets/images/Products-img/Sneakers/jordan-1-retro-high-brown-removebg-preview.png",
    category: {
        name: "sneakers",
        id: "sneakers"
    },
    price: 1000
},
//SNEAKER 4
{
    id: "40",
    name: "Jordan 1 Retro High Red",
    image: "../assets/images/Products-img/Sneakers/jordan-1-retro-high-red-removebg-preview.png",
    category: {
        name: "sneakers",
        id: "sneakers"
    },
    price: 1000
},
//SNEAKER 5
{
    id: "41",
    name: "Nike Dunk Gray",
    image: "../assets/images/Products-img/Sneakers/nike-dunk-gray-removebg-preview.png",
    category: {
        name: "sneakers",
        id: "sneakers"
    },
    price: 1000
},
//SNEAKER 6
{
    id: "42",
    name: "Nike Dunk Retro High Black ",
    image: "../assets/images/Products-img/Sneakers/NIKE-DUNK-HI-RETRO-black-removebg-preview.png",
    category: {
        name: "sneakers",
        id: "sneakers"
    },
    price: 1000
},
//SNEAKER 7
{
    id: "43",
    name: "Reebok Club White",
    image: "../assets/images/Products-img/Sneakers/reebok-tenis-club-white-removebg-preview.png",
    category: {
        name: "sneakers",
        id: "sneakers"
    },
    price: 1000
},
//SNEAKER 8
{
    id: "44",
    name: "Yezzy Black/Red",
    image: "../assets/images/Products-img/Sneakers/yezzy-black-removebg-preview.png",
    category: {
        name: "sneakers",
        id: "sneakers"
    },
    price: 1000
},
//SNEAKER 9
{
    id: "45",
    name: "Yezzy Black/Blue",
    image: "../assets/images/Products-img/Sneakers/yezzy-blue-removebg-preview.png",
    category: {
        name: "sneakers",
        id: "sneakers"
    },
    price: 1000
},

];
//JSON W/ PRODUCTS AND THEIR INFO



//CONSTANTS TO SEARCH ELEMENTS IN THE DOCUMENT
const productsContent = document.getElementById('products-content');//PRODUCTS-CONTENT IS WHERE THE PRODUCTS WILL APPEAR 
const filterBtns = document.querySelectorAll('#filters button');//FILTERBTNS ARE THE FILTER BUTTONS TO FILTER PRODUCTS BY CATEGORY
const titleFilter = document.getElementById('filter-title');//ACCOREDING TO THE FILTER BUTTONS THE CATEGORY NAME WILL BE ASSIGN TO THE TITLE
const articlesAmount = document.querySelector('.articles-amount');//WHEN THE USER CLICK ON THE ADD TO CART BTN A RED CIRCLE WITH THE AMOUNT OF PRODUCTS APPEAR ABOVE THE BAG BUTTON
const articlesAmountMobile = document.querySelector('.articles-amount-mobile');//WHEN THE USER CLICK ON THE ADD TO CART BTN A RED CIRCLE WITH THE AMOUNT OF PRODUCTS APPEAR ABOVE THE BAG BUTTON
let btnAdd = document.querySelectorAll('.add-product');//TO SEARCH ALL THE ADD TO CART BTNS
const productsCart = document.querySelector('.cart-articles');//HERE WILL APPAEAR ALL THE PRODUCTS THAT THE USER WANTS TO SHOP
const cartBtn = document.querySelector('.cart-btn');//TO OPEN THE CART MODAL
const cartBtnMobile = document.querySelector('.cart-btn-mobile');//TO OPEN THE CART MODAL
const closeCartBtn = document.querySelector('.close-cart');//TO COLSE THE CART MODAL

const cartModal = document.querySelector('.cart-modal');//WHERE THE PRODUCTS THAT THE USER WANTS TO SHOP WILL APPEAR
const subInput = document.getElementById('subtotal-input');//THE INPUT THAT SHOWS THE SUBTOTAL THE USER HAS TO PAY
const checkoutBtn = document.querySelector('.checkout-btn');//TO MOVE THE CART PAGE WHERE THE USER WILL PAY 


//THIS VARIABLE IS TO SET THE ACTUAL FILTER 
let actualFilter = null;

//EVENT LISTENERS 
//THIS LOOP GO THROUGHT ALL THE FILTER BUTTONS TO FIND THE CILCK EVENT AND WHICH CATEGORY TO SHOW
filterBtns.forEach(function(btn){
    btn.addEventListener('click', ()  =>{
        filterBtns.forEach(button => {button.classList.remove('active-filter')});
        btn.classList.add('active-filter');
        actualFilter = btn.id === "showAll" ? null : btn.id === "showHoodies" ? "hoodies" : btn.id === "showPants" ? "pants" : btn.id === "showShirts" ? "shirts" : btn.id === "showSneakers" ? "sneakers" : null;
        chargeProducts(actualFilter);
    })
});
//THIS EVENTLISTENER IS TO SHOW THE CART MODAL WITH ALL THE PRODUCTS THE USER ADDED
cartBtn.addEventListener('click', () => {
    cartModal.classList.add('cart-visible');
});
cartBtnMobile.addEventListener('click', () => {
    cartModal.classList.add('cart-visible');
});
//THIS EVENTLISTENER IS TO CLOSE THE CART MODAL
closeCartBtn.addEventListener('click', () => {
    cartModal.classList.remove('cart-visible');
});

//THIS EVENET READ THE LOCAL STORAGE TO SEE IF THERE ARE SOME PRODUTS AND MARK THE CART ICON WITH THE RED CIRCLE AND THE AMOUNT OF PRODUCTS INSIDE OF IT 
document.addEventListener('DOMContentLoaded', updateArticleAmount);

//THIS EVENT MOVE THE USER TO THE CART PAGE 
checkoutBtn.addEventListener('click', () =>{
    location.href = "cart.html";
})

//THIS EVENT IS TO DELETE-BTN
document.addEventListener('click',(e) => {deleteproduct(e)});


//FUNCTIONS

//THIS FUNCTION IS TO CHARGE THE DOM WITH THE ACTUAL FILTER 
function chargeDom (){
    chargeProducts(actualFilter);
}

//THIS FUNCTION SEARCH THE ADDBTN WHERE THE USER CLICKED
function searchBtnAdd (){
    btnAdd = document.querySelectorAll('.add-product');
    btnAdd.forEach(btn => {
        btn.addEventListener('click', (e) => addToCart(e));
    })
}

//THIS CONST IS TO GET IN TO THE LOCALSTORAGE AND BRING ALL THE ARRAY POSITIONS TO ADDTOCART FUNCTION
const cartArray = getItemLS();

//THIS FUNCTION SEARCH THE PRODUCT.ID WITH THE SAME OF THE BUTTONCLICKED.ID INSIDE OF THE CARTARRAY AND IF THE PRODUCT ID IS REPEAT INSCREASES THE AMOUNT OF THIS PRODUCT
function addToCart (e){
    const idBtn = e.currentTarget.id;
    console.log(idBtn)
    const addedProduct = productsArray.find(product => product.id === idBtn);//FIND= RETURN THE FIRST ELEMENT IN THE ARRAY THAT MATCHES WITH THE ID
    
    if (cartArray.some(product => product.id === idBtn)){//SOME= IS AN ARRAY METHOD THAT CHECKS IF AT LEAST ONE ELEMENT IN THE ARRAY PASSES THE CONDITION( THE CONDITION IS DEFINE BY ME )
        const indexProduct = cartArray.findIndex(product => product.id === idBtn);//FINDINDEX IS USED TO FIND THE INDEX OF THE FIRST ELEMENT IN AN ARRAY THAT MEETS WITH THE CONDITION 
        cartArray[indexProduct].amount++;
    }else{
        addedProduct.amount = 1;
        cartArray.push(addedProduct);
    }
    updateArticleAmount();    
    saveLS(cartArray);
    displayCart();
    getSubtotal();
}

//THIS FUNCTION IS TO SHOWS THE USER THE AMOUNT OF PRODUCTS HAVE IN THE CART 
function updateArticleAmount (){
    let number = cartArray.reduce((acc, product ) => acc + product.amount, 0)  //Reduce es para recorrer todos los productos
    if(number != 0){
        articlesAmount.classList.add('articles-amount-visible')
        articlesAmountMobile.classList.add('articles-amount-visible')
    }else{
        articlesAmount.classList.remove('articles-amount-visible')
        articlesAmountMobile.classList.remove('articles-amount-visible')
    }
    articlesAmount.innerText = number;
    articlesAmountMobile.innerText = number;
}

//THIS FUNCTION SAVE IN LOCALSTORAGE
function saveLS (product){
    localStorage.setItem('product', JSON.stringify(product));
}

//THIS FUNCTION RETURNS ALL THE PRODUCTS IN THE LOCALSTORAGE
function getItemLS(){
    let product = JSON.parse(localStorage.getItem('product') || '[]');
    return product;
}

//THIS FUNCTION SHOWS ALL THE PRODUCTS WITH THE HTML STRUCTURE THAT I USED 
function displayCart(){
    let product = getItemLS();
    productsCart.innerHTML = "";
    product.forEach((product,index) => {
        let listCart = document.createElement('tr');
        listCart.innerHTML = `
            <td><img width="100px" height="100px" class="cart-img" src="${product.image}" alt=""></td>
            <td><span class="product-name">${product.name}</span></td>
            <td><span class="product-amount">${product.amount}</span></td>
            <td><span class="product-price">$${product.price}</span></td>
            <td><button class="delete-product" data-index=${index}><svg class="icon-size-super-mini fill-white" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"/></svg></button></td>
        `;
        productsCart.appendChild(listCart);
    })
}

//THIS FUNCTION CHARGE THE PRODUCTS ACCORDING WITH THE FILTER THAT THE USER CHOOSED
function chargeProducts (actualFilter){ 
    productsContent.innerHTML = "";
    if (actualFilter === null){
        titleFilter.innerText = "All Products";
    }else{
        titleFilter.innerText = `${actualFilter}`;
    }
    productsArray.forEach(product => {
        if(actualFilter === null || product.category?.id === actualFilter){
            let productsList = document.createElement('div');
            productsList.classList.add('product-container');
            productsList.innerHTML = `
                <img src="${product.image}" alt="product image" class="product-img">
                <div class="product-details flex column">
                    <h3 class="product-name">${product.name}</h3>
                    <span class="product-price">$${product.price}</span>
                    <button class="add-product" id="${product.id}">Add To Cart</button>
                </div>
            `;
            productsContent.appendChild(productsList)
        }
    })
    searchBtnAdd();
}

//THIS FUNCTION ADD ALL THE PRODUCTS.PRICE AND GIVE THE TOTAL TO USER
function getSubtotal(){
    let products = getItemLS();
    let total = 0
    products.forEach((product) => {
        let price = parseInt(product.price);
        total += price
    })
    subInput.value = "Subtotal: $"+ total;
    
}

//THIS FUNCTION IS TO DELETE A PRODUCT FROM LOCALSTORAGE AND THE DOM
function deleteproduct(e){
    if(e.target.classList.contains('delete-product')){
        let products = getItemLS();
        console.log(products);
        
        let productID = parseInt(e.target.dataset.index);
        console.log(productID);
        
        products.splice(productID, 1);
        saveLS(products)
        displayCart();
        getSubtotal();
    }
}



//CALLING FUNCTIONS
chargeProducts(actualFilter);
displayCart();
getSubtotal();
